(this["webpackJsonpopen-epidemiologic-sanitary-smart-resources"]=this["webpackJsonpopen-epidemiologic-sanitary-smart-resources"]||[]).push([[0],{105:function(e,t){},147:function(e,t,a){e.exports=a(163)},154:function(e,t,a){},158:function(e,t){},162:function(e,t,a){},163:function(e,t,a){"use strict";a.r(t);var n=a(8),r=a.n(n),o=a(123),c=a.n(o),i=a(100),s=a(64),l=a(88),u=a.n(l),p=a(133),f=a(179),d=a(57),m=a.n(d),g=a(71),h=a(126),b=a(127),w=function(){function e(t){Object(h.a)(this,e),this.cartoAccount=t.cartoAccount,this.cartoMapsKey=t.cartoMapsKey,this.id=t.id,this.sql=t.sql,this.getGeoJSON=t.getGeoJSON,this.aggregationConfig=t.aggregationConfig}return Object(b.a)(e,[{key:"getTiles",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={buffersize:{mvt:1},layers:[{id:this.id,type:"mapnik",options:{sql:this.sql,aggregation:this.aggregationConfig||void 0,id:"cartodb_id"}}]},e.next=3,fetch("https://".concat(this.cartoAccount,".carto.com/api/v1/map").concat(this.cartoMapsKey?"?api_key=".concat(this.cartoMapsKey):""),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 3:return a=e.sent,e.next=6,a.json();case 6:return n=e.sent,e.abrupt("return",n.metadata.tilejson.vector.tiles);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestInfo",get:function(){return{carto_account:this.cartoAccount,carto_maps_key:this.cartoMapsKey,request_id:this.id,sql_query:this.sql,aggregation_config:this.aggregationConfig||void 0}}},{key:"updateSql",set:function(e){this.sql=e}}]),e}(),y="SELECT * FROM covid",v="SELECT cartodb_id, workers, ST_Transform(ST_MakeLine(the_geom, ST_GeomFromText(destination_centroid, 4326)), 3857) as the_geom_webmercator FROM workers_flow WHERE workers > 100 ORDER BY workers DESC",_="csEENa_5uea21ar7wwUKTA",E="dotgis",k="infected_source_layer",j="workers_source_layer";var O=a(180),S=a(183),T=(a(154),function(e){var t=e.mapObject,a=r.a.useState({}),n=Object(s.a)(a,2),o=n[0],c=n[1],i=function(e){return new Intl.NumberFormat("es").format(e)},l=function(){var e=Object(g.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=t.getBounds(),a=[e._ne.lng,e._ne.lat,e._sw.lng,e._sw.lat],n={covid:"SELECT * FROM viewportfeatures(".concat([].concat(a),")"),workersFlow:"SELECT * FROM viewportfeaturescodvidworkersflow(".concat([].concat(a),")")},r=function(e){return"https://dotgis.carto.com/api/v2/sql?q=".concat(e,"&api_key=csEENa_5uea21ar7wwUKTA")};Promise.all([l(r(n.covid)),l(r(n.workersFlow))]).then((function(e){var t=e&&e[0]&&e[0].rows,a=e&&e[1]&&e[1].rows;c({total:i(t[0].total),last_14_days:i(t[0].last_14_days),workersFlow:i(a[0].workers)})})).catch((function(e){console.log(e)}))};return r.a.useEffect((function(){return u(),t.on("moveend",u),function(){return t.off("moveend",u)}}),[t]),r.a.createElement("div",{className:"sidebar"},r.a.createElement("div",{className:"sidebar__indicator"},r.a.createElement("h1",null,o.total),r.a.createElement("h3",null,"Infected. Total")),r.a.createElement("div",{className:"sidebar__indicator"},r.a.createElement("h1",null,o.last_14_days),r.a.createElement("h3",null,"Infected. Last 14 days")),r.a.createElement("div",{className:"sidebar__indicator"},r.a.createElement("h1",null,o.workersFlow),r.a.createElement("h3",null,"Workers flow")))}),F=Object(S.a)().domain([0,100,500,1e3,1500,Number.MAX_SAFE_INTEGER]).range([[1,152,189,150],[73,227,206,150],[216,254,181,150],[254,237,177,150],[254,173,84,150],[209,55,78,255]]),M=Object(S.a)().domain([0,100,250,500,1e3,Number.MAX_SAFE_INTEGER]).range([[255,255,255,5],[255,255,255,10],[255,255,255,25],[255,255,255,50],[255,255,255,100],[255,255,255,255]]),x=Object(S.a)().domain([0,100,1e4,1e5,5e5,Number.MAX_SAFE_INTEGER]).range([10,50,200,500]),N=function(){var e,t=r.a.useRef(),a=r.a.useState({latitude:40.51731304944695,longitude:-3.726903525949845,zoom:7.94,maxZoom:16,pitch:0,bearing:0}),o=Object(s.a)(a,2),c=o[0],l=o[1],d=r.a.useState({}),h=Object(s.a)(d,2),b=h[0],S=h[1],N=function(){var e=Object(n.useState)(null),t=Object(s.a)(e,2),a=t[0],o=t[1],c=function(){var e=Object(g.a)(m.a.mark((function e(){var t,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new w({cartoAccount:E,cartoMapsKey:_,id:k,sql:y}),a=new w({cartoAccount:E,cartoMapsKey:_,id:j,sql:v}),Promise.all([t.getTiles(),a.getTiles()]).then((function(e){o({infected_source:{tiles:e[0],type:"polygon"},workers_source:{tiles:e[1],type:"line"}})}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.useEffect((function(){c()}),[]),[a]}(),A=Object(s.a)(N,1)[0];return r.a.createElement(r.a.Fragment,null,(!!u.a.supported()||(alert("Tu navegador no soporta Mapbox GL JS."),!1))&&A&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{layers:(e=A,Object.values(e).map((function(e,t){return new O.a(Object(i.a)({id:t,data:e.tiles[0],minZoom:0,maxZoom:23,lineWidthMinPixels:.5,pickable:!0,autoHighlight:!0,highlightColor:[153,255,204],onHover:function(t){var a=t.x,n=t.y,r=t.object;return function(e){var t=e.x,a=e.y,n=e.object,r=e.field,o=e.label;S({x:t,y:a,hoveredFeature:n,field:r,label:o})}(Object(i.a)({x:a,y:n,object:r},"polygon"===e.type?{field:"total",label:"infected"}:{field:"workers",label:"workers"}))}},"line"===e.type&&{getLineWidth:function(e){return x(e.properties.workers)},getLineColor:function(e){return M(e.properties.workers)},lineJointRounded:!0},{},"polygon"===e.type&&{getFillColor:function(e){return F(e.properties.total)}}))}))),viewState:c,onViewStateChange:function(e){var t=e.viewState;l(Object(i.a)({},t))},controller:!0},r.a.createElement(p.a,{reuseMaps:!0,mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",preventStyleDiffing:!0,mapboxApiAccessToken:"pk.eyJ1IjoiZG90Z2lzIiwiYSI6ImNqd3Z6amtjMTBjOTA0OW84ZjVvYzF6bjQifQ.LIbUaYq3GaiWTzsBV6YnTA",ref:t}),function(){var e,t=b.x,a=b.y,n=b.hoveredFeature,o=b.field,c=b.label;return n&&r.a.createElement("div",{className:"tooltip",style:{left:t,top:a}},"".concat((e=n.properties[o],new Intl.NumberFormat("es").format(e))," ").concat(c))}()),t.current&&r.a.createElement(T,{mapObject:t.current.getMap()})))};a(162);c.a.render(r.a.createElement(N,null),document.getElementById("root"))}},[[147,1,2]]]);
//# sourceMappingURL=main.5d23f5ec.chunk.js.map